// Generated by CoffeeScript 1.6.3
(function() {
  'use strict';
  var Controller;

  Controller = (function() {
    function Controller($stateParams, newsService, $location, GroupMessage) {
      var _this = this;
      this.kindergarten = {
        id: 1,
        school_id: $stateParams.kindergarten
      };
      this.adminUser = {
        id: 1,
        name: '豆瓣'
      };
      this.readCount = 100;
      this.news = newsService.get({
        school_id: this.kindergarten.school_id,
        news_id: $stateParams.news
      });
      this.showEditBox = false;
      this.startEditing = function(e) {
        _this.backupContent = _this.news.content;
        e.stopPropagation();
        return _this.showEditBox = true;
      };
      this.cancelEditing = function(e) {
        e.stopPropagation();
        _this.news.content = _this.backupContent;
        return _this.showEditBox = false;
      };
      this.save = function(e) {
        e.stopPropagation();
        _this.showEditBox = false;
        if (_this.backupContent !== _this.news.content) {
          return _this.news.$save({
            school_id: _this.kindergarten.school_id,
            news_id: _this.news.news_id
          });
        }
      };
      this.publish = function(news) {
        var msg;
        news.pushlished = true;
        news.$save({
          school_id: _this.kindergarten.school_id,
          news_id: news.news_id
        });
        msg = new GroupMessage;
        msg.school_id = parseInt(_this.kindergarten.school_id);
        msg.news_id = news.news_id;
        return msg.$save();
      };
      this.hidden = function(news) {
        news.pushlished = false;
        return news.$save({
          school_id: _this.kindergarten.school_id,
          news_id: news.news_id
        });
      };
      this.editingTitle = false;
      this.backupTitle = this.news.title;
      this.saveTitle = function(e) {
        e.stopPropagation();
        _this.editingTitle = false;
        if (_this.backupTitle !== _this.news.title) {
          return _this.news.$save({
            school_id: _this.kindergarten.school_id,
            news_id: _this.news.news_id
          });
        }
      };
      this.startEditingTitle = function(e) {
        e.stopPropagation();
        _this.backupTitle = _this.news.title;
        return _this.editingTitle = true;
      };
      this.deleteMe = function() {
        _this.news.$delete({
          school_id: _this.kindergarten.school_id,
          news_id: _this.news.news_id
        });
        return $location.path("/kindergarten/" + _this.kindergarten.school_id + "/bulletin");
      };
    }

    return Controller;

  })();

  angular.module('kulebaoAdmin').controller('NewsEditCtrl', ['$stateParams', 'newsService', '$location', 'GroupMessage', Controller]);

}).call(this);
